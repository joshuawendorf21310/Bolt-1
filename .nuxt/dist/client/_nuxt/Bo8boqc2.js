const v=()=>{const i=useSupabaseClient();return{createPrivatePartyInvoice:async e=>{const r=`INV-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,{data:a,error:n}=await i.from("private_party_invoices").insert({invoice_number:r,encounter_id:e.encounterId,service_type:e.serviceType,payer_type:e.payerType,payer_name:e.payerName,payer_email:e.payerEmail,amount_total:e.amountTotal,amount_insurance_paid:e.amountInsurancePaid,amount_patient_responsibility:e.amountPatientResponsibility,amount_outstanding:e.amountPatientResponsibility,due_date:e.dueDate,status:"draft"}).select().single();if(n)throw n;return a},createStripeInvoice:async(e,r)=>{const{data:a}=await i.from("private_party_invoices").select("*").eq("id",e).maybeSingle();if(!a)throw new Error("Invoice not found");const n=`https://stripe-checkout-placeholder.com/invoice/${a.invoice_number}`,{error:o}=await i.from("private_party_invoices").update({stripe_customer_id:r||null,stripe_hosted_url:n,status:"sent",sent_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e);if(o)throw o;return{stripeHostedUrl:n}},getInvoicesByEmail:async e=>{const{data:r,error:a}=await i.from("private_party_invoices").select("*").eq("payer_email",e).order("created_at",{ascending:!1});if(a)throw a;return r||[]},getInvoiceDetails:async e=>{const{data:r}=await i.from("private_party_invoices").select("*").eq("id",e).maybeSingle(),{data:a}=await i.from("patient_statements").select("*").eq("invoice_id",e).maybeSingle(),{data:n}=await i.from("payment_plans").select("*").eq("invoice_id",e).maybeSingle(),{data:o}=await i.from("billing_disputes").select("*").eq("invoice_id",e);return{invoice:r,statement:a,paymentPlan:n,disputes:o||[]}},getPrivatePayAnalytics:async()=>{const{data:e}=await i.from("private_party_invoices").select("*"),r=e?.reduce((t,s)=>t+Number(s.amount_paid),0)||0,a=e?.reduce((t,s)=>t+Number(s.amount_outstanding),0)||0,n=e?.filter(t=>t.payment_status==="paid").length||0,o=e?.filter(t=>t.payment_status==="failed").length||0,c=e?.filter(t=>t.payment_status==="disputed").length||0,u=e?.filter(t=>t.service_type==="ambulance_transport").reduce((t,s)=>t+Number(s.amount_paid),0)||0,p=e?.filter(t=>t.service_type==="telehealth").reduce((t,s)=>t+Number(s.amount_paid),0)||0;return{totalRevenue:r,outstandingBalance:a,paidCount:n,failedCount:o,disputedCount:c,completionRate:e?.length?n/e.length*100:0,ambulanceRevenue:u,telehealthRevenue:p}}}};export{v as u};

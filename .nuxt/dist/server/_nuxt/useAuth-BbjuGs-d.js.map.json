{"file":"useAuth-BbjuGs-d.js","mappings":";;AAGA,MAAM,oBAAoB;AACnB,SAAS,YAAY,MAAM;AAChC,QAAM,UAAU,OAAO,KAAK,KAAK,SAAS,CAAC,MAAM,WAAW,KAAK,IAAG,IAAK;AACzE,MAAI,OAAO,KAAK,CAAC,MAAM,UAAU;AAC/B,SAAK,QAAQ,OAAO;AAAA,EACtB;AACA,QAAM,CAAC,MAAM,IAAI,IAAI;AACrB,MAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;AACrC,UAAM,IAAI,UAAU,6CAA6C,IAAI;AAAA,EACvE;AACA,MAAI,SAAS,UAAU,OAAO,SAAS,YAAY;AACjD,UAAM,IAAI,MAAM,gDAAgD,IAAI;AAAA,EACtE;AACA,QAAM,MAAM,oBAAoB;AAChC,QAAM,UAAU,WAAU;AAC1B,QAAM,QAAQ,MAAM,QAAQ,QAAQ,OAAO,GAAG;AAC9C,MAAI,MAAM,UAAU,UAAU,MAAM;AAClC,UAAM,eAAe,KAAI;AACzB,QAAI,MAAM,YAAY,GAAG;AACvB,cAAQ,QAAQ,MAAM,GAAG,IAAI;AAC7B,aAAO;AAAA,IACT;AACA,UAAM,QAAQ;AAAA,EAChB;AACA,SAAO;AACT;AC5BO,MAAM,UAAU,MAAM;AAC3B,QAAM,EAAE,UAAA,IAAc,WAAA;AACtB,QAAM,OAAO,SAAc,QAAQ,MAAM,IAAI;AAC7C,QAAM,WAAW,SAAc,YAAY,MAAM,IAAI;AAErD,QAAM,eAAe,YAAY;AAC/B,UAAM,EAAE,MAAM,EAAE,QAAA,MAAc,MAAM,UAAU,KAAK,WAAA;AAEnD,QAAI,SAAS,MAAM;AACjB,WAAK,QAAQ,QAAQ;AAErB,YAAM,EAAE,MAAM,aAAA,IAAiB,MAAM,UAClC,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,WAAW,QAAQ,KAAK,EAAE,EAC7B,YAAA;AAEH,eAAS,QAAQ;AAAA,IACnB;AAAA,EACF;AAEA,QAAM,SAAS,OAAO,OAAe,aAAqB;AACxD,UAAM,EAAE,MAAM,MAAA,IAAU,MAAM,UAAU,KAAK,mBAAmB;AAAA,MAC9D;AAAA,MACA;AAAA,IAAA,CACD;AAED,QAAI,MAAO,OAAM;AAEjB,SAAK,QAAQ,KAAK;AAElB,UAAM,EAAE,MAAM,aAAA,IAAiB,MAAM,UAClC,KAAK,WAAW,EAChB,OAAO,GAAG,EACV,GAAG,WAAW,KAAK,KAAK,EAAE,EAC1B,YAAA;AAEH,aAAS,QAAQ;AAEjB,WAAO;AAAA,EACT;AAEA,QAAM,UAAU,YAAY;AAC1B,UAAM,UAAU,KAAK,QAAA;AACrB,SAAK,QAAQ;AACb,aAAS,QAAQ;AAAA,EACnB;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;","names":[],"sources":["../../../../node_modules/nuxt/dist/app/composables/state.js","../../../../composables/useAuth.ts"],"sourcesContent":["import { isRef, toRef } from \"vue\";\nimport { useNuxtApp } from \"../nuxt.js\";\nimport { toArray } from \"../utils.js\";\nconst useStateKeyPrefix = \"$s\";\nexport function useState(...args) {\n  const autoKey = typeof args[args.length - 1] === \"string\" ? args.pop() : void 0;\n  if (typeof args[0] !== \"string\") {\n    args.unshift(autoKey);\n  }\n  const [_key, init] = args;\n  if (!_key || typeof _key !== \"string\") {\n    throw new TypeError(\"[nuxt] [useState] key must be a string: \" + _key);\n  }\n  if (init !== void 0 && typeof init !== \"function\") {\n    throw new Error(\"[nuxt] [useState] init must be a function: \" + init);\n  }\n  const key = useStateKeyPrefix + _key;\n  const nuxtApp = useNuxtApp();\n  const state = toRef(nuxtApp.payload.state, key);\n  if (state.value === void 0 && init) {\n    const initialValue = init();\n    if (isRef(initialValue)) {\n      nuxtApp.payload.state[key] = initialValue;\n      return initialValue;\n    }\n    state.value = initialValue;\n  }\n  return state;\n}\nexport function clearNuxtState(keys) {\n  const nuxtApp = useNuxtApp();\n  const _allKeys = Object.keys(nuxtApp.payload.state).map((key) => key.substring(useStateKeyPrefix.length));\n  const _keys = !keys ? _allKeys : typeof keys === \"function\" ? _allKeys.filter(keys) : toArray(keys);\n  for (const _key of _keys) {\n    const key = useStateKeyPrefix + _key;\n    if (key in nuxtApp.payload.state) {\n      nuxtApp.payload.state[key] = void 0;\n    }\n  }\n}\n","export const useAuth = () => {\n  const { $supabase } = useNuxtApp()\n  const user = useState<any>('user', () => null)\n  const employee = useState<any>('employee', () => null)\n\n  const checkSession = async () => {\n    const { data: { session } } = await $supabase.auth.getSession()\n\n    if (session?.user) {\n      user.value = session.user\n\n      const { data: employeeData } = await $supabase\n        .from('employees')\n        .select('*')\n        .eq('user_id', session.user.id)\n        .maybeSingle()\n\n      employee.value = employeeData\n    }\n  }\n\n  const signIn = async (email: string, password: string) => {\n    const { data, error } = await $supabase.auth.signInWithPassword({\n      email,\n      password\n    })\n\n    if (error) throw error\n\n    user.value = data.user\n\n    const { data: employeeData } = await $supabase\n      .from('employees')\n      .select('*')\n      .eq('user_id', data.user.id)\n      .maybeSingle()\n\n    employee.value = employeeData\n\n    return data\n  }\n\n  const signOut = async () => {\n    await $supabase.auth.signOut()\n    user.value = null\n    employee.value = null\n  }\n\n  return {\n    user,\n    employee,\n    checkSession,\n    signIn,\n    signOut\n  }\n}\n"],"version":3}
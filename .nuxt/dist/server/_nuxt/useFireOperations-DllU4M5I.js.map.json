{"file":"useFireOperations-DllU4M5I.js","mappings":"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","names":[],"sources":["../../../../composables/useFireOperations.ts"],"sourcesContent":["import { ref, computed } from 'vue'\n\nexport const useFireOperations = () => {\n  const { $supabase } = useNuxtApp()\n  const supabase = $supabase\n\n  const incidents = ref<any[]>([])\n  const apparatus = ref<any[]>([])\n  const personnel = ref<any[]>([])\n  const stations = ref<any[]>([])\n  const currentDepartment = ref<string>('')\n  const loading = ref(false)\n  const error = ref<string | null>(null)\n\n  const loadIncidents = async () => {\n    try {\n      loading.value = true\n      const { data, error: err } = await supabase\n        .from('fire_incidents')\n        .select(`\n          *,\n          incident_units (\n            id,\n            status,\n            apparatus_id,\n            crew_lead,\n            personnel_count,\n            dispatch_time,\n            arrival_time\n          ),\n          incident_personnel (\n            id,\n            personnel_id,\n            role,\n            status\n          )\n        `)\n        .order('dispatch_time', { ascending: false })\n        .limit(50)\n\n      if (err) throw err\n      incidents.value = data || []\n    } catch (e: any) {\n      error.value = e.message\n    } finally {\n      loading.value = false\n    }\n  }\n\n  const loadApparatus = async () => {\n    try {\n      const { data, error: err } = await supabase\n        .from('fire_apparatus')\n        .select(`\n          *,\n          station_id (\n            id,\n            name,\n            call_sign\n          )\n        `)\n        .order('unit_number')\n\n      if (err) throw err\n      apparatus.value = data || []\n    } catch (e: any) {\n      error.value = e.message\n    }\n  }\n\n  const loadPersonnel = async () => {\n    try {\n      const { data, error: err } = await supabase\n        .from('fire_personnel')\n        .select(`\n          *,\n          fire_certifications (\n            id,\n            certification_name,\n            expiration_date,\n            is_current\n          )\n        `)\n        .eq('is_active', true)\n        .order('last_name')\n\n      if (err) throw err\n      personnel.value = data || []\n    } catch (e: any) {\n      error.value = e.message\n    }\n  }\n\n  const loadStations = async () => {\n    try {\n      const { data, error: err } = await supabase\n        .from('fire_stations')\n        .select('*')\n        .eq('is_active', true)\n        .order('name')\n\n      if (err) throw err\n      stations.value = data || []\n    } catch (e: any) {\n      error.value = e.message\n    }\n  }\n\n  const createIncident = async (incidentData: any) => {\n    try {\n      loading.value = true\n      const { data, error: err } = await supabase\n        .from('fire_incidents')\n        .insert([incidentData])\n        .select()\n        .single()\n\n      if (err) throw err\n      incidents.value.unshift(data)\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    } finally {\n      loading.value = false\n    }\n  }\n\n  const updateIncidentStatus = async (incidentId: string, status: string) => {\n    try {\n      const { data, error: err } = await supabase\n        .from('fire_incidents')\n        .update({\n          status,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', incidentId)\n        .select()\n        .single()\n\n      if (err) throw err\n\n      const idx = incidents.value.findIndex(i => i.id === incidentId)\n      if (idx >= 0) {\n        incidents.value[idx] = data\n      }\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    }\n  }\n\n  const assignUnitToIncident = async (incidentId: string, apparatusId: string, crewLead?: string) => {\n    try {\n      const { data, error: err } = await supabase\n        .from('incident_units')\n        .insert([{\n          incident_id: incidentId,\n          apparatus_id: apparatusId,\n          crew_lead: crewLead,\n          dispatch_time: new Date().toISOString(),\n          status: 'dispatched'\n        }])\n        .select()\n        .single()\n\n      if (err) throw err\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    }\n  }\n\n  const assignPersonnelToIncident = async (\n    incidentId: string,\n    personnelId: string,\n    role: string,\n    unitId?: string\n  ) => {\n    try {\n      const { data, error: err } = await supabase\n        .from('incident_personnel')\n        .insert([{\n          incident_id: incidentId,\n          personnel_id: personnelId,\n          role,\n          unit_id: unitId,\n          dispatch_time: new Date().toISOString(),\n          status: 'assigned'\n        }])\n        .select()\n        .single()\n\n      if (err) throw err\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    }\n  }\n\n  const updatePersonnelStatus = async (\n    incidentPersonnelId: string,\n    status: string,\n    timestamp: string = 'dispatch_time'\n  ) => {\n    try {\n      const update: any = { status }\n      if (timestamp === 'arrival') update.arrival_time = new Date().toISOString()\n      if (timestamp === 'departure') update.departure_time = new Date().toISOString()\n      if (timestamp === 'check_in') update.accountability_check_in = new Date().toISOString()\n      if (timestamp === 'check_out') update.accountability_check_out = new Date().toISOString()\n\n      const { data, error: err } = await supabase\n        .from('incident_personnel')\n        .update(update)\n        .eq('id', incidentPersonnelId)\n        .select()\n        .single()\n\n      if (err) throw err\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    }\n  }\n\n  const updateApparatusStatus = async (apparatusId: string, status: string) => {\n    try {\n      const { data, error: err } = await supabase\n        .from('fire_apparatus')\n        .update({\n          current_status: status,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', apparatusId)\n        .select()\n        .single()\n\n      if (err) throw err\n\n      const idx = apparatus.value.findIndex(a => a.id === apparatusId)\n      if (idx >= 0) {\n        apparatus.value[idx] = data\n      }\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    }\n  }\n\n  const recordTraining = async (personnelId: string, trainingData: any) => {\n    try {\n      const { data, error: err } = await supabase\n        .from('fire_training_records')\n        .insert([{\n          personnel_id: personnelId,\n          ...trainingData\n        }])\n        .select()\n        .single()\n\n      if (err) throw err\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    }\n  }\n\n  const recordCertification = async (personnelId: string, certData: any) => {\n    try {\n      const { data, error: err } = await supabase\n        .from('fire_certifications')\n        .insert([{\n          personnel_id: personnelId,\n          ...certData\n        }])\n        .select()\n        .single()\n\n      if (err) throw err\n      return data\n    } catch (e: any) {\n      error.value = e.message\n      return null\n    }\n  }\n\n  const getIncidentById = (id: string) => {\n    return incidents.value.find(i => i.id === id)\n  }\n\n  const getPersonnelById = (id: string) => {\n    return personnel.value.find(p => p.id === id)\n  }\n\n  const getApparatusById = (id: string) => {\n    return apparatus.value.find(a => a.id === id)\n  }\n\n  const activeIncidents = computed(() => {\n    return incidents.value.filter(i => i.status !== 'cleared')\n  })\n\n  const respondingUnits = computed(() => {\n    return apparatus.value.filter(a => a.current_status === 'in_service')\n  })\n\n  const availableUnits = computed(() => {\n    return apparatus.value.filter(a => a.current_status === 'available')\n  })\n\n  const certificationExpiringPersonnel = computed(() => {\n    const thirtyDaysFromNow = new Date()\n    thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30)\n\n    return personnel.value.filter(p => {\n      return p.fire_certifications?.some((cert: any) => {\n        if (!cert.is_current) return false\n        const expDate = new Date(cert.expiration_date)\n        return expDate <= thirtyDaysFromNow\n      })\n    })\n  })\n\n  return {\n    // State\n    incidents,\n    apparatus,\n    personnel,\n    stations,\n    loading,\n    error,\n\n    // Loaders\n    loadIncidents,\n    loadApparatus,\n    loadPersonnel,\n    loadStations,\n\n    // Incident operations\n    createIncident,\n    updateIncidentStatus,\n    getIncidentById,\n\n    // Unit operations\n    assignUnitToIncident,\n    updateApparatusStatus,\n    getApparatusById,\n\n    // Personnel operations\n    assignPersonnelToIncident,\n    updatePersonnelStatus,\n    recordTraining,\n    recordCertification,\n    getPersonnelById,\n\n    // Computed\n    activeIncidents,\n    respondingUnits,\n    availableUnits,\n    certificationExpiringPersonnel\n  }\n}\n"],"version":3}
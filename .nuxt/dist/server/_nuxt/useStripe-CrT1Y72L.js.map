{"version":3,"file":"useStripe-CrT1Y72L.js","sources":["../../../../composables/useStripe.ts"],"sourcesContent":["export const useStripe = () => {\n  const supabase = useSupabaseClient()\n\n  const createPrivatePartyInvoice = async (data: {\n    encounterId: string\n    serviceType: 'ambulance_transport' | 'telehealth'\n    payerType: 'patient' | 'guarantor' | 'private_party'\n    payerName: string\n    payerEmail: string\n    amountTotal: number\n    amountInsurancePaid: number\n    amountPatientResponsibility: number\n    dueDate: string\n  }) => {\n    const invoiceNumber = `INV-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n\n    const { data: invoice, error } = await supabase\n      .from('private_party_invoices')\n      .insert({\n        invoice_number: invoiceNumber,\n        encounter_id: data.encounterId,\n        service_type: data.serviceType,\n        payer_type: data.payerType,\n        payer_name: data.payerName,\n        payer_email: data.payerEmail,\n        amount_total: data.amountTotal,\n        amount_insurance_paid: data.amountInsurancePaid,\n        amount_patient_responsibility: data.amountPatientResponsibility,\n        amount_outstanding: data.amountPatientResponsibility,\n        due_date: data.dueDate,\n        status: 'draft'\n      })\n      .select()\n      .single()\n\n    if (error) throw error\n    return invoice\n  }\n\n  const createStripeInvoice = async (invoiceId: string, stripeCustomerId?: string) => {\n    const { data: invoice } = await supabase\n      .from('private_party_invoices')\n      .select('*')\n      .eq('id', invoiceId)\n      .maybeSingle()\n\n    if (!invoice) throw new Error('Invoice not found')\n\n    const stripeInvoiceUrl = `https://stripe-checkout-placeholder.com/invoice/${invoice.invoice_number}`\n\n    const { error } = await supabase\n      .from('private_party_invoices')\n      .update({\n        stripe_customer_id: stripeCustomerId || null,\n        stripe_hosted_url: stripeInvoiceUrl,\n        status: 'sent',\n        sent_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', invoiceId)\n\n    if (error) throw error\n\n    return { stripeHostedUrl: stripeInvoiceUrl }\n  }\n\n  const getInvoicesByEmail = async (email: string) => {\n    const { data, error } = await supabase\n      .from('private_party_invoices')\n      .select('*')\n      .eq('payer_email', email)\n      .order('created_at', { ascending: false })\n\n    if (error) throw error\n    return data || []\n  }\n\n  const getInvoiceDetails = async (invoiceId: string) => {\n    const { data: invoice } = await supabase\n      .from('private_party_invoices')\n      .select('*')\n      .eq('id', invoiceId)\n      .maybeSingle()\n\n    const { data: statement } = await supabase\n      .from('patient_statements')\n      .select('*')\n      .eq('invoice_id', invoiceId)\n      .maybeSingle()\n\n    const { data: paymentPlan } = await supabase\n      .from('payment_plans')\n      .select('*')\n      .eq('invoice_id', invoiceId)\n      .maybeSingle()\n\n    const { data: disputes } = await supabase\n      .from('billing_disputes')\n      .select('*')\n      .eq('invoice_id', invoiceId)\n\n    return {\n      invoice,\n      statement,\n      paymentPlan,\n      disputes: disputes || []\n    }\n  }\n\n  const getPrivatePayAnalytics = async () => {\n    const { data: invoices } = await supabase\n      .from('private_party_invoices')\n      .select('*')\n\n    const totalRevenue = invoices?.reduce((sum, inv) => sum + Number(inv.amount_paid), 0) || 0\n    const outstandingBalance = invoices?.reduce((sum, inv) => sum + Number(inv.amount_outstanding), 0) || 0\n    const paidCount = invoices?.filter(inv => inv.payment_status === 'paid').length || 0\n    const failedCount = invoices?.filter(inv => inv.payment_status === 'failed').length || 0\n    const disputedCount = invoices?.filter(inv => inv.payment_status === 'disputed').length || 0\n\n    const ambulanceRevenue = invoices\n      ?.filter(inv => inv.service_type === 'ambulance_transport')\n      .reduce((sum, inv) => sum + Number(inv.amount_paid), 0) || 0\n\n    const telehealthRevenue = invoices\n      ?.filter(inv => inv.service_type === 'telehealth')\n      .reduce((sum, inv) => sum + Number(inv.amount_paid), 0) || 0\n\n    return {\n      totalRevenue,\n      outstandingBalance,\n      paidCount,\n      failedCount,\n      disputedCount,\n      completionRate: invoices?.length ? (paidCount / invoices.length) * 100 : 0,\n      ambulanceRevenue,\n      telehealthRevenue\n    }\n  }\n\n  return {\n    createPrivatePartyInvoice,\n    createStripeInvoice,\n    getInvoicesByEmail,\n    getInvoiceDetails,\n    getPrivatePayAnalytics\n  }\n}\n"],"names":[],"mappings":"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"}
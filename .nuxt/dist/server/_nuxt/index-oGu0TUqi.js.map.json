{"file":"index-oGu0TUqi.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual","_ssrInterpolate","_ssrRenderList"],"sources":["../../../../composables/useBilling.ts","../../../../pages/billing/index.vue"],"sourcesContent":["export const useBilling = () => {\n  const { supabase } = useApi();\n\n  const AMBULANCE_CODES = {\n    BLS: { code: 'A0428', description: 'Ambulance service, basic life support, non-emergency transport' },\n    BLS_EMERGENCY: { code: 'A0429', description: 'Ambulance service, basic life support, emergency transport' },\n    ALS1: { code: 'A0426', description: 'Ambulance service, advanced life support, non-emergency transport, level 1' },\n    ALS1_EMERGENCY: { code: 'A0427', description: 'Ambulance service, advanced life support, emergency transport, level 1' },\n    ALS2: { code: 'A0433', description: 'Ambulance service, advanced life support, level 2' },\n    SCT: { code: 'A0434', description: 'Ambulance service, specialty care transport' },\n    MILEAGE: { code: 'A0425', description: 'Ground mileage, per statute mile' }\n  };\n\n  const determineAmbulanceCode = (levelOfService: string, isEmergency: boolean) => {\n    if (levelOfService === 'BLS') {\n      return isEmergency ? AMBULANCE_CODES.BLS_EMERGENCY : AMBULANCE_CODES.BLS;\n    } else if (levelOfService === 'ALS1') {\n      return isEmergency ? AMBULANCE_CODES.ALS1_EMERGENCY : AMBULANCE_CODES.ALS1;\n    } else if (levelOfService === 'ALS2') {\n      return AMBULANCE_CODES.ALS2;\n    } else if (levelOfService === 'SCT') {\n      return AMBULANCE_CODES.SCT;\n    }\n    return AMBULANCE_CODES.BLS;\n  };\n\n  const generateClaimFromIncident = async (incidentId: string, organizationId: string) => {\n    try {\n      const { data: incident, error: incidentError } = await supabase\n        .from('incidents')\n        .select(`\n          *,\n          patients (*),\n          transport_data (*)\n        `)\n        .eq('id', incidentId)\n        .single();\n\n      if (incidentError) throw incidentError;\n\n      const patient = incident.patients[0];\n      const transport = incident.transport_data[0];\n\n      if (!transport) {\n        throw new Error('No transport data found for this incident');\n      }\n\n      const claimNumber = `CLM-${Date.now()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;\n\n      const isEmergency = transport.patient_acuity === 'emergent';\n      const baseCode = determineAmbulanceCode(transport.level_of_service, isEmergency);\n\n      const baseCharge = {\n        BLS: 450,\n        BLS_EMERGENCY: 550,\n        ALS1: 650,\n        ALS1_EMERGENCY: 750,\n        ALS2: 950,\n        SCT: 1200\n      }[transport.level_of_service] || 450;\n\n      const mileageRate = 12.50;\n      const mileageCharge = transport.total_mileage * mileageRate;\n      const totalCharge = baseCharge + mileageCharge;\n\n      const { data: claim, error: claimError } = await supabase\n        .from('claims')\n        .insert([{\n          organization_id: organizationId,\n          incident_id: incidentId,\n          patient_id: patient.id,\n          payer_id: patient.primary_insurance_payer_id,\n          claim_number: claimNumber,\n          claim_type: 'professional',\n          total_charge: totalCharge,\n          balance: totalCharge,\n          service_date: new Date(transport.created_at).toISOString().split('T')[0],\n          status: 'draft',\n          medical_necessity_documented: !!transport.medical_necessity_reason\n        }])\n        .select()\n        .single();\n\n      if (claimError) throw claimError;\n\n      const claimLines = [\n        {\n          claim_id: claim.id,\n          line_number: 1,\n          procedure_code: baseCode.code,\n          procedure_description: baseCode.description,\n          modifier_1: 'QM',\n          modifier_2: 'QN',\n          origin_code: transport.origin_code,\n          destination_code: transport.destination_code || 'H',\n          unit_charge: baseCharge,\n          units: 1,\n          total_charge: baseCharge,\n          service_date: claim.service_date,\n          diagnosis_pointers: ['A']\n        }\n      ];\n\n      if (transport.total_mileage > 0) {\n        claimLines.push({\n          claim_id: claim.id,\n          line_number: 2,\n          procedure_code: AMBULANCE_CODES.MILEAGE.code,\n          procedure_description: AMBULANCE_CODES.MILEAGE.description,\n          origin_code: transport.origin_code,\n          destination_code: transport.destination_code || 'H',\n          unit_charge: mileageRate,\n          units: transport.total_mileage,\n          total_charge: mileageCharge,\n          service_date: claim.service_date,\n          diagnosis_pointers: ['A']\n        });\n      }\n\n      const { error: linesError } = await supabase\n        .from('claim_lines')\n        .insert(claimLines);\n\n      if (linesError) throw linesError;\n\n      await supabase\n        .from('audit_logs')\n        .insert([{\n          organization_id: organizationId,\n          action: 'create',\n          resource_type: 'claim',\n          resource_id: claim.id,\n          details: { claim_number: claimNumber, incident_id: incidentId }\n        }]);\n\n      return { success: true, claim };\n    } catch (error) {\n      console.error('Error generating claim:', error);\n      return { success: false, error };\n    }\n  };\n\n  const getClaims = async (organizationId: string, filters = {}) => {\n    try {\n      let query = supabase\n        .from('claims')\n        .select(`\n          *,\n          patients (\n            first_name,\n            last_name,\n            date_of_birth\n          ),\n          incidents (\n            incident_number\n          ),\n          payers (\n            name,\n            payer_type\n          ),\n          claim_lines (*)\n        `)\n        .eq('organization_id', organizationId)\n        .order('created_at', { ascending: false });\n\n      if (filters.status) {\n        query = query.eq('status', filters.status);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n\n      return { success: true, data };\n    } catch (error) {\n      console.error('Error fetching claims:', error);\n      return { success: false, error };\n    }\n  };\n\n  const submitClaim = async (claimId: string, method: 'office_ally_837p' | 'lob_paper') => {\n    try {\n      const { data: claim, error: claimError } = await supabase\n        .from('claims')\n        .select(`\n          *,\n          patients (*),\n          incidents (*),\n          payers (*),\n          claim_lines (*),\n          claim_diagnoses (*)\n        `)\n        .eq('id', claimId)\n        .single();\n\n      if (claimError) throw claimError;\n\n      const { error: statusError } = await supabase\n        .from('claims')\n        .update({\n          status: 'submitted',\n          submission_method: method,\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', claimId);\n\n      if (statusError) throw statusError;\n\n      const { data: submission, error: submissionError } = await supabase\n        .from('claim_submissions')\n        .insert([{\n          claim_id: claimId,\n          submission_method: method,\n          submitted_at: new Date().toISOString()\n        }])\n        .select()\n        .single();\n\n      if (submissionError) throw submissionError;\n\n      return { success: true, submission };\n    } catch (error) {\n      console.error('Error submitting claim:', error);\n      return { success: false, error };\n    }\n  };\n\n  const analyzeDenials = async (organizationId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('denied_claims')\n        .select(`\n          *,\n          claims (\n            claim_number,\n            total_charge,\n            payers (name)\n          )\n        `)\n        .eq('claims.organization_id', organizationId)\n        .order('denied_at', { ascending: false });\n\n      if (error) throw error;\n\n      const denialsByReason = data.reduce((acc, denial) => {\n        const reason = denial.denial_reason_description;\n        if (!acc[reason]) {\n          acc[reason] = { count: 0, total_amount: 0 };\n        }\n        acc[reason].count++;\n        acc[reason].total_amount += denial.claims.total_charge;\n        return acc;\n      }, {});\n\n      return {\n        success: true,\n        data,\n        denialsByReason,\n        totalDenials: data.length,\n        totalAmount: data.reduce((sum, d) => sum + d.claims.total_charge, 0)\n      };\n    } catch (error) {\n      console.error('Error analyzing denials:', error);\n      return { success: false, error };\n    }\n  };\n\n  const validateMedicalNecessity = (transport: any) => {\n    const issues: string[] = [];\n\n    if (!transport.medical_necessity_reason || transport.medical_necessity_reason.length < 20) {\n      issues.push('Medical necessity reason is too short or missing');\n    }\n\n    if (!transport.patient_acuity) {\n      issues.push('Patient acuity not documented');\n    }\n\n    if (!transport.patient_condition_codes || transport.patient_condition_codes.length === 0) {\n      issues.push('No condition codes documented');\n    }\n\n    if (transport.level_of_service === 'ALS2' && transport.patient_acuity !== 'emergent') {\n      issues.push('ALS2 typically requires emergent acuity');\n    }\n\n    return {\n      valid: issues.length === 0,\n      issues\n    };\n  };\n\n  return {\n    AMBULANCE_CODES,\n    determineAmbulanceCode,\n    generateClaimFromIncident,\n    getClaims,\n    submitClaim,\n    analyzeDenials,\n    validateMedicalNecessity\n  };\n};\n","<template>\n  <div class=\"min-h-screen bg-gray-50 py-8\">\n    <div class=\"max-w-7xl mx-auto px-4\">\n      <div class=\"flex justify-between items-center mb-6\">\n        <div>\n          <h1 class=\"text-3xl font-bold text-gray-900\">Billing & Claims</h1>\n          <p class=\"text-gray-600 mt-1\">CMS-compliant ambulance billing management</p>\n        </div>\n        <div class=\"flex gap-3\">\n          <button\n            @click=\"showFilters = !showFilters\"\n            class=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50\"\n          >\n            Filters\n          </button>\n        </div>\n      </div>\n\n      <div v-if=\"showFilters\" class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6\">\n        <div class=\"grid grid-cols-4 gap-4\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\n            <select v-model=\"filters.status\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md\">\n              <option value=\"\">All Statuses</option>\n              <option value=\"draft\">Draft</option>\n              <option value=\"ready\">Ready</option>\n              <option value=\"submitted\">Submitted</option>\n              <option value=\"accepted\">Accepted</option>\n              <option value=\"paid\">Paid</option>\n              <option value=\"denied\">Denied</option>\n            </select>\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Payer Type</label>\n            <select v-model=\"filters.payerType\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md\">\n              <option value=\"\">All Payers</option>\n              <option value=\"medicare\">Medicare</option>\n              <option value=\"medicaid\">Medicaid</option>\n              <option value=\"commercial\">Commercial</option>\n              <option value=\"workers_comp\">Workers Comp</option>\n              <option value=\"self_pay\">Self Pay</option>\n            </select>\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-1\">Submission Method</label>\n            <select v-model=\"filters.submissionMethod\" class=\"w-full px-3 py-2 border border-gray-300 rounded-md\">\n              <option value=\"\">All Methods</option>\n              <option value=\"office_ally_837p\">Electronic (837P)</option>\n              <option value=\"lob_paper\">Paper (Lob)</option>\n            </select>\n          </div>\n          <div class=\"flex items-end\">\n            <button\n              @click=\"applyFilters\"\n              class=\"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\"\n            >\n              Apply Filters\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"grid grid-cols-4 gap-6 mb-6\">\n        <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <div class=\"flex items-center justify-between\">\n            <div>\n              <p class=\"text-sm text-gray-600\">Total Claims</p>\n              <p class=\"text-2xl font-bold text-gray-900 mt-1\">{{ stats.totalClaims }}</p>\n            </div>\n            <div class=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n              <span class=\"text-2xl\">üìÑ</span>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <div class=\"flex items-center justify-between\">\n            <div>\n              <p class=\"text-sm text-gray-600\">Total Billed</p>\n              <p class=\"text-2xl font-bold text-gray-900 mt-1\">${{ stats.totalBilled.toLocaleString() }}</p>\n            </div>\n            <div class=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n              <span class=\"text-2xl\">üí∞</span>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <div class=\"flex items-center justify-between\">\n            <div>\n              <p class=\"text-sm text-gray-600\">Total Paid</p>\n              <p class=\"text-2xl font-bold text-green-600 mt-1\">${{ stats.totalPaid.toLocaleString() }}</p>\n            </div>\n            <div class=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n              <span class=\"text-2xl\">‚úÖ</span>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <div class=\"flex items-center justify-between\">\n            <div>\n              <p class=\"text-sm text-gray-600\">Outstanding</p>\n              <p class=\"text-2xl font-bold text-orange-600 mt-1\">${{ stats.outstanding.toLocaleString() }}</p>\n            </div>\n            <div class=\"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center\">\n              <span class=\"text-2xl\">‚è≥</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n        <div class=\"p-6 border-b border-gray-200\">\n          <h2 class=\"text-lg font-semibold text-gray-900\">Claims List</h2>\n        </div>\n\n        <div v-if=\"loading\" class=\"p-12 text-center text-gray-500\">\n          Loading claims...\n        </div>\n\n        <div v-else-if=\"claims.length === 0\" class=\"p-12 text-center text-gray-500\">\n          No claims found\n        </div>\n\n        <div v-else class=\"overflow-x-auto\">\n          <table class=\"w-full\">\n            <thead class=\"bg-gray-50 border-b border-gray-200\">\n              <tr>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Claim #\n                </th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Patient\n                </th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Service Date\n                </th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Payer\n                </th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Amount\n                </th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status\n                </th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Actions\n                </th>\n              </tr>\n            </thead>\n            <tbody class=\"bg-white divide-y divide-gray-200\">\n              <tr v-for=\"claim in claims\" :key=\"claim.id\" class=\"hover:bg-gray-50\">\n                <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                  {{ claim.claim_number }}\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                  {{ claim.patients.last_name }}, {{ claim.patients.first_name }}\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                  {{ formatDate(claim.service_date) }}\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                  {{ claim.payers?.name || 'N/A' }}\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                  ${{ claim.total_charge.toFixed(2) }}\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap\">\n                  <span\n                    :class=\"[\n                      'px-2 py-1 text-xs font-semibold rounded-full',\n                      getStatusColor(claim.status)\n                    ]\"\n                  >\n                    {{ claim.status }}\n                  </span>\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap text-sm\">\n                  <button\n                    v-if=\"claim.status === 'ready' || claim.status === 'draft'\"\n                    @click=\"submitClaim(claim.id)\"\n                    class=\"text-blue-600 hover:text-blue-900 font-medium mr-3\"\n                  >\n                    Submit\n                  </button>\n                  <button\n                    @click=\"viewClaim(claim.id)\"\n                    class=\"text-gray-600 hover:text-gray-900 font-medium\"\n                  >\n                    View\n                  </button>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, reactive } from 'vue';\n\ndefinePageMeta({\n  middleware: 'auth'\n});\n\nconst { getClaims, submitClaim: submitClaimAPI } = useBilling();\nconst { submitClaim837P } = useOfficeAlly();\nconst { sendPaperClaim } = useLob();\n\nconst claims = ref([]);\nconst loading = ref(true);\nconst showFilters = ref(false);\n\nconst filters = reactive({\n  status: '',\n  payerType: '',\n  submissionMethod: ''\n});\n\nconst stats = reactive({\n  totalClaims: 0,\n  totalBilled: 0,\n  totalPaid: 0,\n  outstanding: 0\n});\n\nconst loadClaims = async () => {\n  loading.value = true;\n\n  const result = await getClaims('demo-org-id', filters);\n\n  if (result.success) {\n    claims.value = result.data;\n    calculateStats(result.data);\n  }\n\n  loading.value = false;\n};\n\nconst calculateStats = (claimsData) => {\n  stats.totalClaims = claimsData.length;\n  stats.totalBilled = claimsData.reduce((sum, c) => sum + c.total_charge, 0);\n  stats.totalPaid = claimsData.reduce((sum, c) => sum + c.total_paid, 0);\n  stats.outstanding = stats.totalBilled - stats.totalPaid;\n};\n\nconst applyFilters = () => {\n  loadClaims();\n};\n\nconst submitClaim = async (claimId) => {\n  if (confirm('Submit this claim electronically via Office Ally or print via Lob?')) {\n    const method = confirm('Click OK for Electronic (837P), Cancel for Paper (Lob)')\n      ? 'electronic'\n      : 'paper';\n\n    if (method === 'electronic') {\n      const result = await submitClaim837P(claimId);\n      if (result.success) {\n        alert('Claim submitted successfully via Office Ally!');\n        loadClaims();\n      } else {\n        alert('Error submitting claim: ' + result.error);\n      }\n    } else {\n      const result = await sendPaperClaim(claimId);\n      if (result.success) {\n        alert('Paper claim sent via Lob!');\n        loadClaims();\n      } else {\n        alert('Error sending paper claim: ' + result.error);\n      }\n    }\n  }\n};\n\nconst viewClaim = (claimId) => {\n  navigateTo(`/billing/${claimId}`);\n};\n\nconst formatDate = (date) => {\n  return new Date(date).toLocaleDateString();\n};\n\nconst getStatusColor = (status) => {\n  const colors = {\n    draft: 'bg-gray-100 text-gray-800',\n    ready: 'bg-blue-100 text-blue-800',\n    submitted: 'bg-yellow-100 text-yellow-800',\n    accepted: 'bg-green-100 text-green-800',\n    paid: 'bg-green-100 text-green-800',\n    denied: 'bg-red-100 text-red-800'\n  };\n  return colors[status] || 'bg-gray-100 text-gray-800';\n};\n\nonMounted(() => {\n  loadClaims();\n});\n</script>\n"],"version":3}
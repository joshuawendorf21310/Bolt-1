{"file":"useApi-BbYKoEyw.js","mappings":"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","names":[],"sources":["../../../../composables/useApi.ts"],"sourcesContent":["export const useApi = () => {\n  const { $supabase } = useNuxtApp()\n  const { employee } = useAuth()\n\n  const handleError = (error: any) => {\n    console.error('API Error:', error)\n    return {\n      success: false,\n      error: error.message || 'An error occurred'\n    }\n  }\n\n  const incidents = {\n    list: async (filters?: any) => {\n      try {\n        let query = $supabase\n          .from('incidents')\n          .select('*')\n          .eq('organization_id', employee.value.organization_id)\n          .order('created_at', { ascending: false })\n\n        if (filters?.status) {\n          if (Array.isArray(filters.status)) {\n            query = query.in('status', filters.status)\n          } else {\n            query = query.eq('status', filters.status)\n          }\n        }\n\n        if (filters?.priority) {\n          query = query.eq('priority', filters.priority)\n        }\n\n        const { data, error } = await query\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    get: async (id: string) => {\n      try {\n        const { data, error } = await $supabase\n          .from('incidents')\n          .select('*')\n          .eq('id', id)\n          .single()\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    create: async (incidentData: any) => {\n      try {\n        const { data, error } = await $supabase\n          .from('incidents')\n          .insert({\n            ...incidentData,\n            organization_id: employee.value.organization_id,\n            created_by: employee.value.id,\n            incident_number: `INC-${Date.now()}`,\n            dispatch_time: new Date().toISOString()\n          })\n          .select()\n          .single()\n\n        if (error) throw error\n\n        await $supabase\n          .from('incident_timeline')\n          .insert({\n            incident_id: data.id,\n            event_type: 'Incident Created',\n            created_by: employee.value.id\n          })\n\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    update: async (id: string, updates: any) => {\n      try {\n        const { data, error } = await $supabase\n          .from('incidents')\n          .update(updates)\n          .eq('id', id)\n          .select()\n          .single()\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    }\n  }\n\n  const units = {\n    list: async (filters?: any) => {\n      try {\n        let query = $supabase\n          .from('units')\n          .select('*, unit_type:unit_types(*)')\n          .eq('organization_id', employee.value.organization_id)\n\n        if (filters?.status) {\n          query = query.eq('status', filters.status)\n        }\n\n        if (filters?.is_active !== undefined) {\n          query = query.eq('is_active', filters.is_active)\n        }\n\n        const { data, error } = await query\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    updateStatus: async (id: string, status: string) => {\n      try {\n        const { data, error } = await $supabase\n          .from('units')\n          .update({ status, updated_at: new Date().toISOString() })\n          .eq('id', id)\n          .select()\n          .single()\n\n        if (error) throw error\n\n        await $supabase\n          .from('unit_status_history')\n          .insert({\n            unit_id: id,\n            status,\n            updated_by: employee.value.id\n          })\n\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    }\n  }\n\n  const dispatches = {\n    create: async (incidentId: string, unitId: string) => {\n      try {\n        const { data, error } = await $supabase\n          .from('dispatches')\n          .insert({\n            incident_id: incidentId,\n            unit_id: unitId,\n            assigned_by: employee.value.id,\n            status: 'assigned'\n          })\n          .select()\n          .single()\n\n        if (error) throw error\n\n        await units.updateStatus(unitId, 'dispatched')\n\n        await $supabase\n          .from('incident_timeline')\n          .insert({\n            incident_id: incidentId,\n            event_type: 'Unit Dispatched',\n            created_by: employee.value.id\n          })\n\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    updateStatus: async (id: string, status: string) => {\n      try {\n        const updateData: any = { status }\n\n        if (status === 'acknowledged') updateData.acknowledged_at = new Date().toISOString()\n        if (status === 'enroute') updateData.enroute_at = new Date().toISOString()\n        if (status === 'on_scene') updateData.on_scene_at = new Date().toISOString()\n        if (status === 'cleared') updateData.cleared_at = new Date().toISOString()\n\n        const { data, error } = await $supabase\n          .from('dispatches')\n          .update(updateData)\n          .eq('id', id)\n          .select('*, incident:incidents(*)')\n          .single()\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    }\n  }\n\n  const patientRecords = {\n    list: async (filters?: any) => {\n      try {\n        let query = $supabase\n          .from('patient_records')\n          .select('*, incident:incidents(*), transport:transports(*)')\n          .eq('organization_id', employee.value.organization_id)\n          .order('created_at', { ascending: false })\n\n        if (filters?.status) {\n          query = query.eq('status', filters.status)\n        }\n\n        const { data, error } = await query\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    get: async (id: string) => {\n      try {\n        const { data, error } = await $supabase\n          .from('patient_records')\n          .select('*, incident:incidents(*), transport:transports(*), destination:destinations(*)')\n          .eq('id', id)\n          .single()\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    create: async (recordData: any) => {\n      try {\n        const { data, error } = await $supabase\n          .from('patient_records')\n          .insert({\n            ...recordData,\n            organization_id: employee.value.organization_id,\n            record_number: `PCR-${Date.now()}`,\n            completed_by: employee.value.id\n          })\n          .select()\n          .single()\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    update: async (id: string, updates: any) => {\n      try {\n        const { data, error } = await $supabase\n          .from('patient_records')\n          .update(updates)\n          .eq('id', id)\n          .select()\n          .single()\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    }\n  }\n\n  const transports = {\n    list: async (filters?: any) => {\n      try {\n        let query = $supabase\n          .from('transports')\n          .select('*, unit:units(*), destination:destinations(*), incident:incidents(*)')\n          .order('requested_at', { ascending: false })\n\n        if (filters?.status) {\n          if (Array.isArray(filters.status)) {\n            query = query.in('status', filters.status)\n          } else {\n            query = query.eq('status', filters.status)\n          }\n        }\n\n        const { data, error } = await query\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    },\n\n    create: async (transportData: any) => {\n      try {\n        const { data, error } = await $supabase\n          .from('transports')\n          .insert({\n            ...transportData,\n            requested_by: employee.value.id,\n            status: 'requested'\n          })\n          .select()\n          .single()\n\n        if (error) throw error\n        return { success: true, data }\n      } catch (error) {\n        return handleError(error)\n      }\n    }\n  }\n\n  return {\n    incidents,\n    units,\n    dispatches,\n    patientRecords,\n    transports\n  }\n}\n"],"version":3}